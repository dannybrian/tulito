/*! tulito.js - v1.0.0dev - 2013-11-18
 * http://tulito.org
 *
 * Copyright (c) 2013 Danny Brian <danny@brians.org>;
 * Licensed under the MIT license *//* 
   FIXME: in several places, the library caches data or even nodes directly within the 
   DOM element objects. No, this isn't a great practice. But it does prevent me from 
   having to maintain a cache for this data, or to update that cache when the DOM
   changes. I'm investigating the pros and cons here.
*/(function(e,t){"use strict";var n=70,r=new Object,i=function(){this._inits=new Object;var r=this,i={openedPaneGap:150,openedHiddenPaneGap:24,shovedPaneGap:90,onOrientationChange:null,onHiddenPaneShown:null,onHiddenPaneHidden:null,onBackPaneShown:null,onBackPaneHidden:null};return this.init=function(t){this.options={};for(var n in i)n in t?this.options[n]=t[n]:this.options[n]=i[n];this.options.shovedHiddenRatio=this.options.shovedPaneGap/(e.innerWidth-this.options.openedHiddenPaneGap),this.options.shovedPaneRatio=this.options.shovedPaneGap/(e.innerWidth-this.options.openedPaneGap),this.realCordova=document.URL.indexOf("http://")===-1&&document.URL.indexOf("https://")===-1,document.ontouchmove=function(e){e.srcElement.tagName.toLowerCase()!=="input"&&e.preventDefault()},this.realCordova?(this._orient(),setTimeout(function(){navigator.splashscreen&&navigator.splashscreen.hide()},100)):(e.addEventListener("load",r._orient,!1),e.addEventListener("orientationchange",r._orient,!1));var s=document.querySelectorAll("[data-tulito-id],[data-tulito-class]");for(var o=0;o<s.length;++o)this.apply(s[o])},this.apply=function(e){var t=e.getAttribute("data-tulito-class");this._inits[t]?this._inits[t](e):console.log("tulito class not found: "+t)},this._inits.scrollable=function(e){new iScroll(e,{bounce:!1})},this._inits.button=function(e){Hammer(e).on("touch",function(t){r._buttonTap(e,t)})},this._inits.pane=function(t){t._tx=t._ty=t._tz=0,t._opened=!1,t._thisdrag=null;var i=document.querySelectorAll('[data-tulito-parent="'+t.getAttribute("data-tulito-id")+'"]');for(var s=0;s<i.length;++s){i[s]._tx=i[s]._ty=i[s]._tz=0;var o=i[s].getAttribute("data-tulito-shove");o==="right"?(r._addClass(i[s],"shovedleft"),r._translateEnd(i[s],-r.options.shovedPaneGap,0,0)):o==="left"&&(r._addClass(i[s],"shovedright"),r._translateEnd(i[s],r.options.shovedPaneGap,0,0))}Hammer(t).on("dragstart",function(e){if(e.srcElement!==t)return;r._addClass(t,"notransition");if(!t._opened){t._backpane&&r._removeClass(t._backpane,"shown");var n=document.querySelectorAll('[data-tulito-parent="'+t.getAttribute("data-tulito-id")+'"]');for(var i=0;i<n.length;++i)if(n[i].getAttribute("data-tulito-parentdrag")===e.gesture.direction){t._backpane=n[i],t._shove=n[i].getAttribute("data-tulito-shove"),t._thisdrag=e.gesture.direction,r._addClass(n[i],"shown"),r._addClass(n[i],"notransition"),r.options.onBackPaneShown&&r.options.onBackPaneShown(t);continue}}else r._addClass(t,"notransition"),t._backpane&&t._shove&&r._addClass(t._backpane,"notransition")}),Hammer(t).on("drag",function(n){if(n.srcElement!==t)return;t._opened===!1&&n.gesture.direction===t._thisdrag&&(t._thisdrag==="right"?(r._translate(t,n.gesture.deltaX,0,0,{xMax:(e.innerWidth-r.options.openedPaneGap)*1.1,xMin:0}),t._backpane&&t._shove&&(t._shove==="right"?r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0,{xMax:0,xMin:-r.options.shovedPaneGap}):t._shove==="left"&&r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0,{xMax:r.options.shovedPaneGap,xMin:0}))):t._thisdrag==="left"&&(r._translate(t,n.gesture.deltaX,0,0,{xMax:e.innerWidth,xMin:-(e.innerWidth-r.options.openedPaneGap*.9)}),t._backpane&&t._shove&&(t._shove==="right"?r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0):t._shove==="left"&&r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0)))),t._opened===!0&&n.gesture.direction!==t._thisdrag&&(t._thisdrag==="right"&&n.gesture.direction==="left"?(r._translate(t,n.gesture.deltaX,0,0,{xMax:e.innerWidth-r.options.openedPaneGap,xMin:0}),t._backpane&&t._shove&&(t._shove==="left"?r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0):t._shove==="right"&&r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0))):t._thisdrag==="left"&&n.gesture.direction==="right"&&(r._translate(t,n.gesture.deltaX,0,0,{xMax:0,xMin:-(e.innerWidth-r.options.openedPaneGap)}),t._backpane&&t._shove&&(t._shove==="left"?r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0):t._shove==="right"&&r._translate(t._backpane,n.gesture.deltaX*r.options.shovedPaneRatio,0,0))))}),Hammer(t).on("dragend",function(i){if(i.srcElement!==t)return;if(t._opened===!1&&i.gesture.direction===t._thisdrag)r._removeClass(t,"notransition"),r._resetTranslate(t,!0),t._thisdrag==="right"?Math.abs(i.gesture.deltaX)>n?(r._addClass(t,"opened draggedright"),t._opened=!0,r._translateEnd(t,e.innerWidth-r.options.openedPaneGap,0,0,null,!0),t._backpane&&t._shove&&(r._removeClass(t._backpane,"notransition"),r._resetTranslate(t._backpane,!0),r._translateEnd(t._backpane,0,0,0,null,!0),t._shove==="right"?r._removeClass(t._backpane,"shovedleft"):t._shove==="left"&&r._removeClass(t._backpane,"shovedright"))):(setTimeout(function(){r._removeClass(t._backpane,"shown")},300),r._resetTranslate(t,!0),t._backpane&&t._shove&&(r._removeClass(t._backpane,"notransition"),r._resetTranslate(t._backpane,!0))):t._thisdrag==="left"&&(Math.abs(i.gesture.deltaX)>n?(r._addClass(t,"opened draggedleft"),t._opened=!0,r._translateEnd(t,-(e.innerWidth-r.options.openedPaneGap),0,0,null,!0),t._backpane&&t._shove&&(r._removeClass(t._backpane,"notransition"),r._resetTranslate(t._backpane,!0),r._translateEnd(t._backpane,0,0,0,null,!0),t._shove==="right"?r._removeClass(t._backpane,"shovedleft"):t._shove==="left"&&r._removeClass(t._backpane,"shovedright"))):(setTimeout(function(){r._removeClass(t._backpane,"shown")},300),r._resetTranslate(t),t._backpane&&t._shove&&(r._removeClass(t._backpane,"notransition"),r._resetTranslate(t._backpane,!0))));else if(t._opened===!0&&i.gesture.direction!==t._thisdrag){r._removeClass(t,"notransition"),r._resetTranslate(t,!0);if(t._thisdrag==="left"||t._thisdrag==="right")Math.abs(i.gesture.deltaX)>n?(r._removeClass(t,"opened"),r._resetTranslate(t),t._opened=!1,r.options.onBackPaneHidden&&r.options.onBackPaneHidden(t),t._backpane&&t._shove&&(r._removeClass(t._backpane,"notransition"),r._resetTranslate(t._backpane,!0),t._shove==="right"?(r._translateEnd(t._backpane,-r.options.shovedPaneGap,0,0),r._addClass(t._backpane,"shovedleft")):t._shove==="left"&&(r._translateEnd(t._backpane,r.options.shovedPaneGap,0,0),r._addClass(t._backpane,"shovedright"))),setTimeout(function(){r._removeClass(t._backpane,"shown"),r._removeClass(t,"draggedleft"),r._removeClass(t,"draggedright")},300)):t._backpane&&t._shove&&(r._removeClass(t._backpane,"notransition"),r._resetTranslate(t._backpane,!0),t._backpane&&t._shove&&(r._removeClass(t._backpane,"notransition"),r._resetTranslate(t._backpane,!0)))}else r._resetTranslate(t,!0)})},this._inits["hidden-pane"]=function(t){var i=t.getAttribute("data-tulito-pos");t._tx=t._ty=t._tz=0;var s=t.getAttribute("data-tulito-shove");if(s){var o=document.querySelector('[data-tulito-id="'+s+'"]');t._shove=o,t._shove._tx=t._shove._ty=t._shove._tz=0}Hammer(t).on("dragstart",function(e){r._addClass(t,"notransition"),t._shove&&r._addClass(t._shove,"notransition")}),Hammer(t).on("drag",function(n){n.gesture.direction===i&&(i==="right"?(r._translate(t,n.gesture.deltaX,0,0,{xMax:e.innerWidth,xMin:r.options.openedHiddenPaneGap}),t._shove&&r._translate(t._shove,n.gesture.deltaX*r.options.shovedHiddenRatio,0,0)):i==="left"?(r._translate(t,n.gesture.deltaX,0,0,{xMax:-r.options.openedHiddenPaneGap,xMin:-e.innerWidth}),t._shove&&r._translate(t._shove,n.gesture.deltaX*r.options.shovedHiddenRatio,0,0,{xMax:r.options.shovedPaneGap,xMin:0})):i==="up"?r._translate(t,0,n.gesture.deltaY,0,{yMax:-r.options.openedHiddenPaneGap,yMin:-e.innerHeight}):i==="down"&&r._translate(t,0,n.gesture.deltaY,0,{yMax:e.innerHeight,yMin:r.options.openedHiddenPaneGap}))}),Hammer(t).on("dragend",function(e){if(e.gesture.direction===i){r._removeClass(t,"notransition"),t._shove&&r._removeClass(t._shove,"notransition");if(i==="left"||i==="right")Math.abs(e.gesture.deltaX)>n?(r._removeClass(t,"opened"),r._resetTranslate(t),t._shove&&(r._resetTranslate(t._shove),r._removeClass(t._shove,"shovedleft"),r._removeClass(t._shove,"shovedright")),r.options.onHiddenPaneHidden&&r.options.onHiddenPaneHidden(t),setTimeout(function(){r._removeClass(t,"shown")},300)):(r._resetTranslate(t,!0),t._shove&&r._resetTranslate(t._shove,!0));if(i==="up"||i==="down")Math.abs(e.gesture.deltaY)>n?(r._removeClass(t,"opened"),r._resetTranslate(t),r.options.onHiddenPaneHidden&&r.options.onHiddenPaneHidden(t),setTimeout(function(){r._removeClass(t,"shown")},300)):r._resetTranslate(t,!0)}else r._resetTranslate(t)})},this._inits["back-pane"]=function(e){},this._buttonTap=function(e,t){if(!e)return;this._addClass(e,"active"),e.hasAttribute("data-tulito-open")&&e.getAttribute("data-tulito-open").split(/\s+/).forEach(function(e){r._openPane(document.querySelector('[data-tulito-id="'+e+'"]'),t)}),setTimeout(function(){r._removeClass(e,"active")},200)},this._openPane=function(t,n){if(!t)return;var i=t.getAttribute("data-tulito-class");if(i==="hidden-pane"){var s=t.getAttribute("data-tulito-pos"),o=t.getAttribute("data-tulito-shove");o&&(s==="left"?(r._addClass(t._shove,"shovedright"),r._translateEnd(t._shove,r.options.shovedPaneGap*1.1,0,0,null,!0)):s==="right"&&(r._addClass(t._shove,"shovedleft"),r._translateEnd(t._shove,-(r.options.shovedPaneGap*1.1),0,0,null,!0))),r._addClass(t,"shown"),s==="left"?r._translateEnd(t,-r.options.openedHiddenPaneGap,0,0,null,!0):s==="right"?r._translateEnd(t,r.options.openedHiddenPaneGap,0,0,null,!0):s==="up"?r._translateEnd(t,0,r.options.openedHiddenPaneGap,0,null,!0):s==="down"&&r._translateEnd(t,0,-r.options.openedHiddenPaneGap,0,null,!0),r.options.onHiddenPaneShown&&r.options.onHiddenPaneShown(t),setTimeout(function(){r._addClass(t,"opened")},1)}else if(i==="back-pane"){var u=t.getAttribute("data-tulito-parent"),a=document.querySelector('[data-tulito-id="'+u+'"]'),o=t.getAttribute("data-tulito-shove");if(a._opened){o&&(r._removeClass(t,"notransition"),r._resetTranslate(t));var f=t.getAttribute("data-tulito-parentdrag");f==="left"?(r._removeClass(a,"draggedleft"),o==="right"?(r._addClass(t,"shovedleft"),r._translateEnd(t,-r.options.shovedPaneGap,0,0,null,!0)):o==="left"&&(r._addClass(t,"shovedright"),r._translateEnd(t,r.options.shovedPaneGap,0,0,null,!0))):f==="right"&&(r._removeClass(a,"draggedright"),o==="right"?(r._addClass(t,"shovedleft"),r._translateEnd(t,-r.options.shovedPaneGap,0,0,null,!0)):o==="left"&&(r._addClass(t,"shovedright"),r._translateEnd(t,r.options.shovedPaneGap,0,0,null,!0))),r._removeClass(a,"opened"),a._opened=!1,r._resetTranslate(a),r.options.onBackPaneHidden&&r.options.onBackPaneHidden(t),setTimeout(function(){r._removeClass(t,"shown")},300)}else{a._backpane=t,a._shove=o,r._addClass(t,"shown"),r._addClass(a,"opened"),a._opened=!0,r._resetTranslate(a,!0),o&&(r._removeClass(t,"notransition"),r._resetTranslate(t,!0)),r.options.onBackPaneShown&&r.options.onBackPaneShown(t);var s=t.getAttribute("data-tulito-parentdrag");s==="right"?(a._thisdrag="right",r._addClass(a,"draggedright"),r._translateEnd(a,e.innerWidth-r.options.openedPaneGap,0,0,null,!0),o==="left"?(r._removeClass(t,"shovedright"),r._translateEnd(t,0,0,0,null,!0)):o==="right"&&(r._removeClass(t,"shovedleft"),r._translateEnd(t,0,0,0,null,!0))):s==="left"&&(a._thisdrag="left",r._addClass(a,"draggedleft"),r._translateEnd(a,-r.options.openedPaneGap,0,0,null,!0),o==="left"?(r._removeClass(t,"shovedright"),r._translateEnd(t,0,0,0,null,!0)):o==="right"&&(r._removeClass(t,"shovedleft"),r._translateEnd(t,0,0,0,null,!0)))}}},this._addClass=function(e,t){e.className=e.className+" "+t},this._hasClass=function(e,t){var n=new RegExp("\\s*\\b"+t+"\\b","g");return e.className.match(n)},this._removeClass=function(e,t){var n=new RegExp("\\s*\\b"+t+"\\b","g");e.className=e.className.replace(n,"")},this._translate=function(e,n,r,i,s){var o=e._tx+n,u=e._ty+r,a=e._tz+i;s&&(s.xMax!=t&&(o=Math.min(o,s.xMax)),s.xMin!==t&&(o=Math.max(o,s.xMin)),s.yMax!=t&&(u=Math.min(u,s.yMax)),s.yMin!==t&&(u=Math.max(u,s.yMin))),e.style.webkitTransform="translate("+o+"px,"+u+"px)"+"translateZ("+a+"px)",e.style.msTransform=e.style.MozTransform=e.style.OTransform="translateX("+o+"px,"+u+"px)"},this._translateEnd=function(e,t,n,r,i,s){i&&(e._tx+t>i.xMax&&(e._tx=i.xMax,t=0),e._tx+t<i.xMin&&(e._tx=i.xMin,t=0)),s?(e._tx=t,e._ty=n,e._tz=r):(e._tx=e._tx+t,e._ty=e._ty+n,e._tz=e._tz+r),e.style.webkitTransform="translate("+this._tx+"px,"+this._ty+"px)"+"translateZ("+this._tz+"px)",e.style.msTransform=e.style.MozTransform=e.style.OTransform="translateX("+this._tx+"px,"+this._ty+"px)"},this._resetTranslate=function(e,t){this._removeClass(e,"notransition"),t!==!0&&(e._tx=0,e._ty=0,e._tz=0),setTimeout(function(){e.style.webkitTransform=e.style.msTransform=e.style.MozTransform=e.style.OTransform=""},1)},this._orient=function(){var t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g),n=document.querySelector('meta[name="viewport"]');t&&n&&(n.content.match(/width=device-width/)&&(n.content=n.content.replace(/width=[^,]+/,"width=1")),n.content=n.content.replace(/width=[^,]+/,"width="+e.innerWidth),n.content=n.content.replace(/height=[^,]+/,"height="+e.innerHeight)),less.modifyVars({"@screenWidth":e.innerWidth+"px","@screenHeight":e.innerHeight+"px"}),e.orientation===0?(document.documentElement.style.overflow="",document.body.style.height="100%"):(document.documentElement.style.overflow="",document.body.style.height="100%"),r.options.onOrientationChange&&r.options.onOrientationChange()},this};typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return new i}):typeof module=="object"&&typeof module.exports=="object"?module.exports=new i:e.tulito=new i})(this);